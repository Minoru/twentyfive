/*jshint browser: true, devel: true, camelcase: true, curly: true, eqeqeq: true, undef: true, unused: true, strict: true *//*global $:false */$(document).ready(function(){"use strict";(function(e,t,n){var r=30,i="Time Tracker",s=new Audio("alert.mp3"),o=0,u,a,f,l,c,h,p=0,d=function(){if(n.htt_cycle){h=n.htt_cycle;u=h}else{u=r;h=u;a=h}$("#timer span").countdown({until:0,format:"MS",compact:!0,onExpiry:v,onTick:y});if(typeof Storage!==undefined){var e=0;while(e<n.length){if(n.key(e)==="htt_count"||n.key(e).indexOf("htt_task")===-1)continue;$("#done").prepend(n.getItem(n.key(e)))}if(n.htt_count){$(".count").text(n.htt_count);p=n.htt_count;$("body").addClass("list")}else $("body").addClass("new")}y(i)},v=function(){s.play();$("body").removeClass("working").addClass("log");$("#new").prop("checked",!0);$("#what").focus()},m=function(){$("body").removeClass("working").addClass("log");$("#new").prop("checked",!0);$("#what").focus()},g=function(e){$("body").removeClass("working").addClass(e)},y=function(e){if(!e[5])if(!e){t.title=i;Tinycon.setBubble()}else{t.title=e;Tinycon.setBubble()}else{t.title=e[5]+":"+e[6]+" - "+i;Tinycon.setBubble(e[5])}};$(".set-cycle").on("click",function(){$("body").addClass("settings-open");$("#cycle").val(n.htt_cycle);return!1});$(".set-next").on("click",function(){$("body").addClass("settings-open");$("#nextCycle").val(n.htt_nextCycle);return!1});$("#cycle").on("input",function(){this.value=this.value.replace(/[^0-9]/g,"");h=$(this).val()});$("#nextCycle").on("input",function(){this.value=this.value.replace(/[^0-9]/g,"");a=$(this).val()});$("#cycle-form").submit(function(){if($("#cycle").val()===""){$("#cycle").val(r);n.setItem("htt_cycle",r);n.setItem("htt_nextCycle",r)}else{n.setItem("htt_cycle",h);n.setItem("htt_nextCycle",h)}u=n.htt_cycle;$("body").removeClass("settings-open");return!1});$("#next-form").submit(function(){n.setItem("htt_nextCycle",a);a=n.htt_nextCycle;$("body").removeClass("settings-open");return!1});$("#settings .overlay").on("click",function(){$("body").removeClass("settings-open");$("#cycle").val(n.htt_cycle);$("#nextCycle").val(n.htt_nextCycle)});$(".btn-start").on("click",function(){f=new Date;l=("0"+f.getHours()).slice(-2);c=("0"+f.getMinutes()).slice(-2);$("body").removeClass().addClass("working");$("#timer span").countdown("option",{until:+h*60,onExpiry:v});$("#actions span").hide();$("#reset").show();return!1});$("#end").on("click",function(){o=$("#timer span").countdown("getTimes");$("#timer span").countdown("option",{until:0,onExpiry:m});y(i);return!1});$("#cancel").on("click",function(){if(n.htt_count){$("#timer span").countdown("option",{until:0,onExpiry:null});g("list")}else{$("#timer span").countdown("option",{until:0,onExpiry:null});g("new")}return!1});$("#logActivity").submit(function(){var e=$("#what").val(),t=new Date,r=("0"+t.getHours()).slice(-2),i=("0"+t.getMinutes()).slice(-2),u;p++;n.htt_count=p;s.currentTime=0;s.pause();typeof o[5]!="number"?u=0:u=o[5];var d='<li data-task="htt_task'+("0"+p).slice(-2)+'">'+"<h6>"+l+":"+c+" - "+r+":"+i+"</h6>"+"<p>"+e+"<small>"+(h-u)+" minutes</small></p>"+"</li>";if(a!==h){h=n.htt_nextCycle;n.setItem("htt_cycle",n.htt_nextCycle)}n.setItem("htt_task"+("0"+p).slice(-2),d);$("#done").prepend(d);if($("#new").is(":checked")){$("#timer span").countdown("option",{until:+h*60});$("body").removeClass("log").addClass("working")}else $("body").removeClass("log").addClass("list");f=new Date;l=("0"+f.getHours()).slice(-2);c=("0"+f.getMinutes()).slice(-2);return!1});$("#done").on("mouseenter","li[data-task]",function(){$(this).find("p").prepend("<span class='delete'>&times;</span>");$(this).find(".delete").on("click",function(){var e=$(this).parent().parent().attr("data-task");$(this).parent().parent().remove();n.removeItem(e)})});$("#done").on("mouseleave","li",function(){$(this).find("span.delete").remove()});$("#reset").on("click",function(){$(this).hide();$(this).siblings("span").show();return!1});var b=function(){var e=0;while(e<n.length){if(n.key(e)==="htt_nextCycle"||n.key(e)==="htt_cycle")continue;n.removeItem(n.key(e))}p=0;$("#done").html("");$("body").removeClass().addClass("new");$(".count").text(p);$(this).parent().hide();$(this).parent().siblings("#reset").show();return!1};$("#actions .confirm").on("click",b());var w=function(){$(this).parent().hide();$(this).parent().siblings("#reset").show();return!1};$("#actions .cancel").on("click",w());$(e).blur(function(){s.addEventListener("ended",function(){this.currentTime=0;this.play();t.title===i?y("▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉"):y(i)},!1)});$(e).focus(function(){s.addEventListener("ended",function(){this.currentTime=0;this.pause();y(i)},!1);s.pause();s.currentTime=0});d()})(window,document,localStorage)});